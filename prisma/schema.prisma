generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id             String           @id @default(auto()) @map("_id") @db.ObjectId
  email          String           @unique
  name           String?
  image          String?
  passwordHash   String?
  role           UserRole         @default(USER)
  documents      Document[]
  contracts      Contract[]
  smartContracts SmartContract[]
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
}

model Document {
  id               String            @id @default(auto()) @map("_id") @db.ObjectId
  ownerId          String            @db.ObjectId
  owner            User              @relation(fields: [ownerId], references: [id])
  title            String
  originalName     String
  mimeType         String
  fileId           String?
  status           DocumentStatus    @default(PARSED)
  riskScore        Float?
  riskSummaryJson  Json?
  contentText      String?
  clauses          Clause[]
  versions         DocumentVersion[]
  complianceChecks ComplianceCheck[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
}


model Clause {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  documentId      String        @db.ObjectId
  document        Document      @relation(fields: [documentId], references: [id])
  index           Int
  heading         String?
  text            String
  explanation     String?
  riskLevel       RiskLevel?
  riskReasonsJson Json?
  startPage       Int?
  endPage         Int?
}

model DocumentVersion {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId
  documentId  String    @db.ObjectId
  document    Document  @relation(fields: [documentId], references: [id])
  label       String
  riskScore   Float?
  diffJson    Json?
  createdAt   DateTime  @default(now())
}

model Contract {
  id              String           @id @default(auto()) @map("_id") @db.ObjectId
  ownerId         String           @db.ObjectId
  owner           User             @relation(fields: [ownerId], references: [id])
  title           String
  type            ContractType
  jurisdiction    Jurisdiction
  contentMarkdown String
  generatedFrom   String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model SmartContract {
  id                   String           @id @default(auto()) @map("_id") @db.ObjectId
  ownerId              String           @db.ObjectId
  owner                User             @relation(fields: [ownerId], references: [id])
  title                String
  templateType         SmartTemplateType
  solidityCode         String
  abiJson              Json?
  network              String?
  deployedAddress      String?
  bytecode             String?
  gasEstimation        Float?
  securityFindingsJson Json?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
}

model ComplianceCheck {
  id         String              @id @default(auto()) @map("_id") @db.ObjectId
  documentId String              @db.ObjectId
  document   Document            @relation(fields: [documentId], references: [id])
  standards  ComplianceStandard[]
  resultJson Json
  createdAt  DateTime            @default(now())
}

enum UserRole {
  USER
  ADMIN
}

enum DocumentStatus {
  UPLOADED
  PROCESSING
  PARSED
  ANALYZED
  FAILED
}

enum DocumentType {
  NDA
  EMPLOYMENT
  SAAS
  PURCHASE
  SERVICE
  OTHER
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum ContractType {
  NDA
  SERVICE
  EMPLOYMENT
  PARTNERSHIP
  CUSTOM
}

enum Jurisdiction {
  US
  UK
  EU
  OTHER
}

enum SmartTemplateType {
  ESCROW
  TOKEN_SALE
  DAO_GOVERNANCE
  ROYALTY_SPLIT
}

enum ComplianceStandard {
  GDPR
  CCPA
  SOC2
  HIPAA
  PCI_DSS
}
